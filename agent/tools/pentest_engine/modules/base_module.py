"""Base module for vulnerability scanners."""

from abc import ABC, abstractmethod
from typing import List, Optional
from ..models import Vulnerability
from ..http_client import HTTPClient


class BaseVulnerabilityModule(ABC):
    """Base class for vulnerability scanning modules."""

    def __init__(self, http_client: HTTPClient):
        """Initialize module.

        Args:
            http_client: HTTP client instance
        """
        self.http_client = http_client

    @property
    @abstractmethod
    def name(self) -> str:
        """Module name."""
        pass

    @abstractmethod
    def scan(self, url: str, **kwargs) -> List[Vulnerability]:
        """Scan URL for vulnerabilities.

        Args:
            url: URL to scan
            **kwargs: Additional parameters

        Returns:
            List of found vulnerabilities
        """
        pass

    def _is_error_response(self, response_text: str) -> bool:
        """Check if response contains SQL error indicators.

        Args:
            response_text: Response body text

        Returns:
            True if SQL error detected
        """
        error_patterns = [
            "sql syntax",
            "mysql_fetch",
            "mysqli",
            "sqlserver",
            "postgresql",
            "ora-01",
            "ora-00",
            "microsoft ole db",
            "odbc driver",
            "sqlite_",
            "pg_query",
            "pg_exec",
            "unclosed quotation",
            "syntax error",
            "database error",
            "warning: mysql",
            "valid mysql result",
            "check the manual",
            "error in your sql",
        ]

        response_lower = response_text.lower()
        return any(pattern in response_lower for pattern in error_patterns)
